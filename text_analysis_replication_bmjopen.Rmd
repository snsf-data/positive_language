---
title: "Text analysis of self-promotional language across genders in grant proposals"
header-includes:
   - \usepackage{dcolumn}
   - \usepackage{booktabs}
   - \usepackage{makecell}
output:
  bookdown::word_document2:
    fig_caption: true
urlcolor: #6684c1
bibliography: bib_bmjopen.bib
link-citations: true
---


```{r init, include=FALSE, warning=FALSE}

###  PF, CF, Spark reorder the tables
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE)
knitr::opts_chunk$set(fig.showtext = TRUE)
knitr::knit_hooks$set(
  document = function(x) {
    sub("\\usepackage[]{color}",
        "\\usepackage[table]{xcolor}",
        x,
        fixed = TRUE)
  }
)
options(tinytex.clean = T)

# kableExtra for kable-tables
options(kableExtra.latex.load_packages = FALSE )
library(kableExtra)

library(snf.datastory)
# devtools::install_github("snsf-data/snf.datastory")
# or renv::install("snsf-data/snf.datastory")

# Use here("...") with paths relative to the project root
# to address files
library(here)
# Avoid dependency on load order of packages
library(conflicted)

# conflict_prefers 
# if you'd like to see futher updates, tell rhe.
conflict_prefer("filter", "dplyr")
conflict_prefer("select", "dplyr")
conflict_prefer("here", "here")
conflict_prefer("list", "base")
conflict_prefer("as_image", "kableExtra")
conflict_prefer("group_rows", "kableExtra")
# More libraries
library(cowplot)
library(texreg)
library(broom)
library(dplyr)
library(tm)
# library(cld3)
library(sandwich)
library(msm)
library(tidyr)
library(ggpubr)
library(flextable)
library(ftExtra)
# windowsFonts("Source Sans" = windowsFont("Source Sans Pro Regular"))
# change this to false if desired output is pdf
is_word = TRUE
```

```{r load-ls-data, cache = FALSE, echo = FALSE, results = 'hide'}

# Load the data from Zenodo:
library(readxl)
url <- "https://zenodo.org/record/6676562/files/positive_words_frequencies.xlsx"
destfile <- "positive_words_frequencies.xlsx"
curl::curl_download(url, destfile)

career_freq_ls <-  read_xlsx(destfile, sheet = "career") %>% 
  mutate(Number = 1:n())

sparkabs_freq_ls <- read_xlsx(destfile, sheet = "spark") %>% 
  mutate(Number = 1:n())

pf_freq_ls <- read_xlsx(destfile, sheet = "projects") %>% 
  mutate(Number = 1:n())

# 25 positive words as suggested in Vinkers et al (2015)
pos_words <- c(
  "novel",
  "unique",
  "promising",
  "favorable|favourable",
  "robust",
  "excellent",
  "prominent",
  "supportive",
  "encouraging",
  "remarkable",
  "innovative",
  "unprecedented",
  "bright",
  "enormous",
  "reassuring",
  "creative",
  "assuring",
  "hopeful",
  "astonishing",
  "spectacular",
  "amazing",
  "inventive",
  "phenomenal",
  "groundbreaking",
  "inspiring"
)

```


```{r load-function-etc, cache = FALSE, echo = FALSE, results = 'hide'}
# Code to format tables and figures
source(here::here("paper_draft", "r_functions.R"))
```


```{r load-function-etc2, cache = FALSE, echo = FALSE, results = 'hide'}
# Number of proposals
total_spark <- nrow(sparkabs_freq_ls)
total_pf <- nrow(pf_freq_ls)
total_career <- nrow(career_freq_ls)

# Percentage international applicants
pct_int_spark <- table(sparkabs_freq_ls$NationalityIsoCode=="CH")[1]/
  table(is.na(sparkabs_freq_ls$NationalityIsoCode))[1]*100
pct_int_pf <- table(pf_freq_ls$NationalityIsoCode=="CH")[1]/
  table(is.na(pf_freq_ls$NationalityIsoCode))[1]*100
pct_int_career <- table(career_freq_ls$NationalityIsoCode=="CH")[1]/
  table(is.na(career_freq_ls$NationalityIsoCode))[1]*100

# Success Rates
sr_spark <- sparkabs_freq_ls %>%
  summarise(sr = round(length(which(IsFundable == 1)) / n() * 100, 1))
sr_pf <- pf_freq_ls %>%
  summarise(sr = round(length(which(IsApproved == 1)) / n() * 100, 1))
sr_career <- career_freq_ls %>% 
  summarise(sr = round(length(which(IsApproved == 1)) / n() * 100, 1))


## ----------------------------
## data summary
## ----------------------------
# Gender distribution of applicants and success rate per research area
# ... spark abstracts (only look at fundable vs non-fundable)
gender_spark <- sparkabs_freq_ls %>%
  group_by(ResponsibleApplicantGender,
           IsFundable) %>%
  count() %>%
  group_by(ResponsibleApplicantGender) %>%
  mutate(total = sum(n),
         rate_plot = n/total,
         rate = paste0(format(round(n * 100 / total, 1), nsmall = 1), "%")) %>%
  # filter(IsFundable == 1) %>%
  select(ResponsibleApplicantGender,
         IsFundable,
         n,
         rate,
         rate_plot,
         total)


# ... pf
gender_pf <- pf_freq_ls %>%
  group_by(ResponsibleApplicantGender,
           IsApproved) %>%
  count() %>% 
  group_by(ResponsibleApplicantGender) %>%
  mutate(total = sum(n),
         rate_plot = n/total,
         rate = paste0(format(round(n * 100 / total, 1), nsmall = 1), "%")) %>%
  # filter(IsApproved == 1) %>%
  select(ResponsibleApplicantGender,
         IsApproved,
         n,
         rate,
         rate_plot,
         total)

# ... career
gender_career <- career_freq_ls %>%
  group_by(ResponsibleApplicantGender,
           IsApproved) %>%
  count() %>%
  group_by(ResponsibleApplicantGender) %>%
  mutate(total = sum(n),
         rate_plot = n/total,
         rate = paste0(format(round(n * 100 / total, 1), nsmall = 1), "%")) %>%
  # filter(IsApproved == 1) %>%
  select(ResponsibleApplicantGender,
         IsApproved,
         n, 
         rate,
         rate_plot,
         total)


# EDA % of applications with positive words

spark_numbers <- sparkabs_freq_ls %>% 
  select(Number, sum_pos) %>%
  mutate(is_positive = if_else(sum_pos > 0, 1, 0)) %>%
  group_by(is_positive) %>%
  summarise(n_app = n(), .groups = "drop")

pf_numbers <- pf_freq_ls %>% 
  select(Number, sum_pos) %>%
  mutate(is_positive = if_else(sum_pos > 0,1,0)) %>%
  group_by(is_positive) %>%
  summarise(n_app = n(), .groups = "drop")

career_numbers <- career_freq_ls %>% 
  select(Number, sum_pos) %>%
  mutate(is_positive = if_else(sum_pos > 0, 1, 0)) %>%
  group_by(is_positive) %>%
  summarise(n_app = n(), .groups = "drop")


# EDA overall success rate
spark_success <- sparkabs_freq_ls %>% 
  group_by(IsFundable) %>%
  summarise(n_app= n(), .groups = "drop")

pf_success <- pf_freq_ls %>% 
  group_by(IsApproved) %>%
  summarise(n_app = n(), .groups = "drop")

career_success <- career_freq_ls %>% 
  group_by(IsApproved) %>%
  summarise(n_app = n(), .groups = "drop")

## -----------------------------------------------
## analyze specific words
## -----------------------------------------------

## ----plot specific words ----
sparkabs_plot <-
  plot_positivewords(word_prevalence = count_prevalence(sparkabs_freq_ls),
                     pos_words = pos_words)
pf_plot <- plot_positivewords(word_prevalence = count_prevalence(pf_freq_ls),
                              pos_words = pos_words)
career_plot <-
  plot_positivewords(word_prevalence = count_prevalence(career_freq_ls),
                     pos_words = pos_words)
```

```{r all calculations part 2, cache = FALSE, echo = FALSE, results = 'hide'}
#analyze the effects of gender on language
#--------------------------------------
## analysis: gender on language
#--------------------------------------
# Analysis of the whether gender has an effect on the use of words as through..
# .. binary variable for the presence of at least one positive word
# .. .. using linear probability models
# .. .. using logistic regression models
# .. the count of distinct positive words using Poisson regression
# .. .. quasipoisson and negative binomial regression


# spark abstracts
# ---------------
sparkabs_reg_ls <- sparkabs_freq_ls %>%
  analyze_gender()
# pf abstracts
# ---------------
pf_reg_ls <- analyze_gender(dat = pf_freq_ls)

# career abstracts
# ---------------
career_reg_ls <- analyze_gender(dat =  career_freq_ls)

```

```{r all calculations part 3, cache = FALSE, echo = FALSE, results = 'hide'}
# analyze the effects of gender and language on grant
#------------------------------------------------------------------
# analysis: gender and language on grant
#------------------------------------------------------------------
# Analysis of the whether gender in interaction with the 'binary variable for
# presence of positive words' or the 'sum of positive words' has an effect on
# funding decisions

# spark abstracts
# ---------------
sparkabs_grant_ls <- analyze_grant(dat = sparkabs_freq_ls)

# pf abstracts
# ---------------
pf_grant_ls <- analyze_grant(dat = pf_freq_ls)

# career abstracts
# ---------------
career_grant_ls <- analyze_grant(dat = career_freq_ls)


```

```{r extract-funded-ls}

# Extract LS:
sparkabs_freq_ls_fundable <- sparkabs_freq_ls %>% 
  filter(IsFundable == 1)
gender_spark_ls_fundable <- gender_spark %>% 
  filter(IsFundable == 1)

pf_freq_ls_approved <- pf_freq_ls %>% 
  filter(IsApproved == 1) 
gender_pf_ls_approved <- gender_pf %>% 
  filter(IsApproved == 1)

career_freq_ls_approved <- career_freq_ls %>% 
  filter(IsApproved == 1)
gender_career_ls_approved <- gender_career %>% 
  filter(IsApproved == 1)

spark_numbers_ls_fundable <- sparkabs_freq_ls_fundable %>% 
  select(Number, sum_pos) %>%
  mutate(is_positive = if_else(sum_pos>0,1,0)) %>%
  group_by(is_positive) %>%
  summarise(n_app= n(), .groups="drop")

pf_numbers_ls_approved <- pf_freq_ls_approved %>% 
  select(Number, sum_pos) %>%
  mutate(is_positive = if_else(sum_pos>0,1,0)) %>%
  group_by(is_positive) %>%
  summarise(n_app= n(), .groups="drop")

career_numbers_ls_approved <- career_freq_ls_approved %>% 
  select(Number, sum_pos) %>%
  mutate(is_positive = if_else(sum_pos>0,1,0)) %>%
  group_by(is_positive) %>%
  summarise(n_app= n(), .groups="drop")

```



# Abstract{-}
**Objectives:** To investigate whether the use of positive, self-promotional language in grant proposals correlates with the gender of the applicant. Potential differences across different types of funding schemes are examined. This study is a replication and generalisation of analyses previously presented in @Lerchenmueller, which analysed positive language usage in published biomedical articles.  The setting of the current work is grant proposals submitted to the Swiss National Science Foundation (SNSF). 

**Design:** Cross-sectional analysis using multivariate, logistic, and Poisson regression models.

**Results:** Unlike previous studies, no strong correlations between the use of self-promotional language and gender were identified. In Projects, the main funding scheme of the SNSF that funds independent bottom-up research, evidence that male applicants of successful proposals used on average a higher count of self-promotional words in their proposal abstracts than their successful female peers was found (Rate Ratio of 1.09; 95% CI 1.006 to 1.182). However, no evidence of a gender difference was found in the other funding schemes analysed.  Further, no evidence for a difference in the use of self-promotional words between the genders was found when considering all submitted proposals instead of only successful proposals.

**Conclusion(s):** We see it as an encouraging result that self-promotional language does not play an outsized role in the funding of good research. The use of positive words does not seem to be an explanatory factor in the differences of research funding awarded to male and female grant applicants.


# Introduction

The “leaky pipeline” of female researchers leaving academic careers is well-established (@Goulden2011, @Moss-Racusin2012, @Lundine2018). Although the percentage of female researchers at earlier career stages is growing, there are still markedly fewer independent female researchers than their male peers, and the percentage of female researchers in leadership positions is still small. If female researchers are receiving fewer research grants than their male peers, this will limit their career advancement. It is therefore important for research funding agencies to investigate whether their funding practices are encouraging or hindering the careers of the researchers they fund.

Bias against female grant applicants has been observed across research funding agencies. A study from the Swiss National Science Foundation found that both male and female peer reviewers graded female applicants more harshly than male applicants, even when potentially confounding factors were taken into consideration (@Severin2020). In the US, a text analysis by the National Institutes of Health found that peer reviewers used different language to describe male and female grant applicants, where male applicants were more likely to be described as leaders (@Magua2017). The Canadian Institutes of Health Research found that male applicants were more likely to receive funding than female applicants, but that this was because female applicants were evaluated less favorably as principal investigators, not because of any difference in the quality of their proposals (@Witteman2019). Evidence of bias in the evaluation of track records of female applicants was also found in the Netherlands (@Van_der_Lee2015). The current study aims to determine if the language used by the applicants themselves in their abstracts is contributing to the different treatment of grant proposals from male and female principal investigators.

It is well-established that scientists often over-inflate the importance of their work in order to get published or funded (@Ioannidis2014, @Chiu2017). There is evidence that men use more self-promotional language than women when describing their own work histories (@Reuben2014). In this analysis we investigate whether there is a gender difference in the use of self-promotional language in grant proposals.

Female authors of medical and life sciences articles were previously observed to use strongly positive language less frequently to describe their research than their male counterparts (@Lerchenmueller). This work is a replication of the Lerchenmueller study, applying and extending the same techniques to understand if their results can also be observed in the context of research grant proposals. We analyse proposals submitted to three different funding schemes at the Swiss National Science Foundation, where the importance of the track record of the applicant varies considerably. We hypothesize that whether an applicant must present themselves as a whole package, as opposed to just promoting a single project idea, may influence how they describe their research. 

We do not investigate whether the use of positive language influences the eventual funding of the grant proposal in this work. Such an analysis necessitates further considerations, such as adjusting for a wide variety of confounding variables, that are beyond the scope of this study. The SNSF has published in-depth analyses of its own funding decisions elsewhere (@snsf).

In @Vinkers2015 the authors established a list of 25 positive words that they selected after manual analysis of biomedical texts from PubMed. They observed a significant increase in the use of these words across all PubMed literature over a 40-year period, and concluded that this is likely due to the positive-outcome bias in scientific publishing - that only research with the most unprecedented positive results will be published. We use these same words as the basis for our study. This list was developed specifically for studying biomedical texts, and preliminary analyses have suggested that the usage of these words differs somewhat in other research areas.  Writing styles can differ substantially between academic disciplines (@Hyland2006), as can grading cultures. For these reasons, we will limit our replication study to grant proposals coming from the broad domain of life sciences.

We acknowledge that this study searches for the presence of these specific words, and does not perform any analysis of the context of the text surrounding the words. Random checks confirmed that the words are used as expected the vast majority of the time, but there are undoubtedly some instances where authors describe their own work using positive words in the negative, such as “not creative”.

The results of this study should be of broad interest to the international scientific community, as Swiss scientific research is very competitive internationally. In fact, over 51% of the Swiss-based researchers included in this study originated from countries outside Switzerland (based on their current citizenship). This analysis is also important as a replication study of an important result in the literature.  

# Data and Methods

## Data

```{r summary-statistics}

tab_fi <- pf_freq_ls %>% 
  summarise(n_perc = format(n(), big.mark = "'")) %>% 
  bind_cols(career_freq_ls %>%
              summarise(n_perc_car = format(n(), big.mark = "'"))) %>% 
  bind_cols(sparkabs_freq_ls %>%
              summarise(n_perc_spark = format(n(), big.mark = "'"))) %>% 
  mutate(variable = "") %>% 
  select(variable, everything())

tab_gender <- pf_freq_ls %>% 
  group_by(ResponsibleApplicantGender) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(perc = n / sum(n) * 100,
         n_perc = paste0(format(n, big.mark = "'"), " (", round(perc, 1), "%)"),
         ResponsibleApplicantGender = 
           case_when(ResponsibleApplicantGender == "f" ~ "Female applicants",
                     ResponsibleApplicantGender == "m" ~ "Male applicants")) %>% 
  rename(variable = ResponsibleApplicantGender) %>% 
  select(variable, n_perc) %>% 
  bind_cols(career_freq_ls %>% 
              group_by(ResponsibleApplicantGender) %>% 
              count() %>% 
              ungroup() %>% 
              mutate(perc = n / sum(n) * 100,
                     n_perc_car = paste0(format(n, big.mark = "'"), 
                                         " (", round(perc, 1), "%)")) %>% 
              select(n_perc_car)) %>% 
    bind_cols(sparkabs_freq_ls %>% 
              group_by(ResponsibleApplicantGender) %>% 
              count() %>% 
              ungroup() %>% 
              mutate(perc = n / sum(n) * 100,
                     n_perc_spark = paste0(format(n, big.mark = "'"),
                                           " (", round(perc, 1), "%)")) %>% 
                select(n_perc_spark))

tab_inst <- pf_freq_ls %>% 
  mutate(ResearchInstitutionType = 
           case_when(ResearchInstitutionType %in% 
                       c("Other", "Other research institutes", 
                         "Hospitals (non-university)",
                         "University of applied sciences") ~ "UAS and Other",
                     TRUE ~ ResearchInstitutionType)) %>% 
  group_by(ResearchInstitutionType) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(perc = n / sum(n) * 100,
         n_perc = paste0(format(n, big.mark = "'"),
                         " (", round(perc, 1), "%)")) %>% 
  rename(variable = ResearchInstitutionType) %>% 
  select(variable, n_perc) %>% 
  bind_cols(career_freq_ls %>% 
              mutate(ResearchInstitutionType = 
                       case_when(ResearchInstitutionType %in% 
                                   c("Other", "Other research institutes", 
                                     "Hospitals (non-university)",
                                     "University of applied sciences") ~ "UAS and Other",
                                 TRUE ~ ResearchInstitutionType)) %>% 
              group_by(ResearchInstitutionType) %>% 
              count() %>% 
              ungroup() %>% 
              mutate(perc = n / sum(n) * 100,
                     n_perc_car = paste0(format(n, big.mark = "'"), 
                                         " (", round(perc, 1), "%)")) %>% 
              select(n_perc_car)) %>% 
  bind_cols(sparkabs_freq_ls %>% 
              mutate(ResearchInstitutionType = 
                       case_when(ResearchInstitutionType %in% 
                                   c("Other", "Other research institutes", 
                                     "Hospitals (non-university)",
                                     "University of applied sciences") ~ "UAS and Other",
                                 TRUE ~ ResearchInstitutionType)) %>% 
              group_by(ResearchInstitutionType) %>% 
              count() %>% 
              ungroup() %>% 
              mutate(perc = n / sum(n) * 100,
                     n_perc_spark = paste0(format(n, big.mark = "'"),
                                           " (", round(perc, 1), "%)")) %>% 
                select(n_perc_spark))

tab_year <- pf_freq_ls %>%  
  group_by(CallYear) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(perc = n / sum(n) * 100,
         n_perc = paste0(format(n, big.mark = "'"),
                         " (", round(perc, 1), "%)")) %>% 
  mutate(variable = as.character(CallYear)) %>% 
  select(variable, n_perc) %>% 
  left_join(career_freq_ls %>%   
              group_by(CallYear) %>% 
              count() %>% 
              ungroup() %>% 
              mutate(perc = n / sum(n) * 100,
                     n_perc_car = paste0(format(n, big.mark = "'"), 
                                         " (", round(perc, 1), "%)")) %>% 
              mutate(variable = as.character(CallYear)) %>%
              select(variable, n_perc_car)) %>% 
  left_join(sparkabs_freq_ls %>% 
              group_by(CallDecisionYear) %>% 
              count() %>% 
              ungroup() %>% 
              mutate(perc = n / sum(n) * 100,
                     n_perc_spark = paste0(format(n, big.mark = "'"),
                                           " (", round(perc, 1), "%)")) %>% 
              mutate(variable = as.character(CallDecisionYear)) %>% 
              select(variable, n_perc_spark))

tab_age <- pf_freq_ls %>%  
  summarise(n_perc = 
              paste0(round(mean(ResponsibleApplicantAgeAtSubmission), 1), 
                     " (", min(ResponsibleApplicantAgeAtSubmission), " - ",
                     max(ResponsibleApplicantAgeAtSubmission), ")")) %>% 
  mutate(variable = "Mean (min-max)") %>% 
  select(variable, n_perc) %>% 
  bind_cols(career_freq_ls %>% 
              summarise(
                n_perc_car = 
                  paste0(round(mean(ResponsibleApplicantAgeAtSubmission), 1), 
                         " (", min(ResponsibleApplicantAgeAtSubmission), " - ",
                         max(ResponsibleApplicantAgeAtSubmission), ")")) %>% 
              select(n_perc_car)) %>% 
  bind_cols(sparkabs_freq_ls %>% 
              summarise(
                n_perc_spark = 
                  paste0(round(mean(ResponsibleApplicantAgeAtSubmission), 1), 
                         " (", min(ResponsibleApplicantAgeAtSubmission), " - ",
                         max(ResponsibleApplicantAgeAtSubmission), ")")) %>% 
              select(n_perc_spark))

tab_textlength <- pf_freq_ls %>%  
  summarise(n_perc = paste0(round(mean(text_length), 1), " (",
                            min(text_length), " - ",
                            format(max(text_length), big.mark = "'"), ")")) %>% 
  mutate(variable = "Mean (min - max)") %>% 
  select(variable, n_perc) %>% 
  bind_cols(career_freq_ls %>% 
              summarise(
                n_perc_car =
                  paste0(round(mean(text_length), 1), " (",
                         min(text_length), " - ", 
                         format(max(text_length), big.mark = "'"), ")")) %>% 
              select(n_perc_car)) %>% 
  bind_cols(sparkabs_freq_ls %>% 
              summarise(
                n_perc_spark = 
                  paste0(round(mean(text_length), 1), " (",
                         min(text_length), " - ", 
                         format(max(text_length), big.mark = "'"), ")")) %>% 
              select(n_perc_spark))

tab_sum_pos <- pf_freq_ls %>%  
  summarise(n_perc = paste0(round(mean(sum_pos), 1), " (", min(sum_pos), " - ",
                            max(sum_pos), ")")) %>% 
  mutate(variable = "Mean (min - max)") %>% 
  select(variable, n_perc) %>% 
  bind_cols(career_freq_ls %>% 
              summarise(
                n_perc_car = paste0(round(mean(sum_pos), 1), " (", 
                                    min(sum_pos), "-", max(sum_pos), ")")) %>% 
              select(n_perc_car)) %>% 
  bind_cols(sparkabs_freq_ls %>% 
              summarise(
                n_perc_spark = paste0(round(mean(sum_pos), 1), " (",
                                      min(sum_pos), "-", max(sum_pos), ")")) %>% 
              select(n_perc_spark))
```

The data comes from research grant proposals to the Swiss National Science Foundation (SNSF) in the ten years between 2011 and 2020, and one shorter funding scheme. This study looks at the titles and abstracts from three different funding schemes, and investigates whether any of the 25 positive words identified by @Vinkers2015 appear in these texts, and if so, how frequently. Only English-language proposals are considered, which means that 0.3% of the available Career proposals and of the available Career proposals and 0.3% of the Project proposals had to be removed before processing.

As part of the proposal submission process, applicants identify their own gender, so we are able to know with certainty the gender of each applicant. This differs from the Lerchenmueller study (@Lerchenmueller), where they had to make educated guesses about the gender of the authors based on their names. For the purposes of this study, we only consider the corresponding applicant on each proposal, although one of the three funding schemes included (Projects) can also involve multiple co-applicants.

We investigate whether there is a correlation between the gender and the use of positive words in each funding scheme. Raw data about the number and distribution of proposals is provided in Figure \@ref(fig:summary-numbers) and Table \@ref(tab:tab1). 

Researchers come from three types of research institutions: Cantonal universities are the 12 large public research universities; the ETH-Domain consists the Swiss Federal Institutes of Technology (two universities - ETHZ and EPFL - and four research institutions); and the Universities of Applied Sciences (UAS) focus on practice-oriented qualifications.

The three funding schemes included in this study are:

**Projects**: This is the biggest funding scheme at the SNSF, and funds bottom-up research. Independent researchers with contracts at Swiss research institutions are eligible to apply for this funding scheme. The track record is considered, but is only one part of the complete proposal. The researchers are on average `r tab_age %>% select(n_perc) %>% substr( 1, 4)` years old and most of them are employed at cantonal universities, `r tab_inst %>% filter(variable == "Cantonal university") %>% pull(n_perc)`. 
<!-- 15,785  -->
`r pf_freq_ls %>% nrow() %>% format(big.mark = "'")` proposals from Projects are included in this study, 
<!-- 51.7 -->
`r pf_numbers %>% mutate(perc = n_app/sum(n_app)) %>% filter(is_positive == 1) %>% pull(perc) %>% round(2) *100`% of which contain at least one of the positive words. 

**Careers** (Ambizione, Excellenza, Professorships): These funding schemes are meant to support early-career researchers to be able to lead independent projects. The target researchers are a couple years past the completion of their PhDs, and are aiming for, but do not yet have, permanent tenure-track professorships. The track record of these applicants is very important for the success of their proposals. 
<!-- 4,648  -->
`r career_freq_ls %>% nrow() %>% format(big.mark = "'")`
proposals from Careers are included in this study, 
<!-- 55.1 -->
`r career_numbers %>% mutate(perc = n_app/sum(n_app)) %>% filter(is_positive == 1) %>% pull(perc) %>% round(2) *100`% of which contain at least one of the positive words. Compared to the Projects instrument, the applicants to the career schemes are on average younger (`r tab_age %>% select(n_perc_car) %>% substr( 1, 4)` years). 

**Spark**: This is a pilot funding scheme that is meant to support rapid funding of unconventional ideas. There have only been two calls as of 2020, so this dataset is smaller than the other two. The evaluation procedure is double-blind, and so the track record of the applicant should be of no importance to the proposal. 
<!-- 1,532  -->
`r sparkabs_freq_ls%>% nrow() %>% format(big.mark = "'")` proposals from Spark are included in this study, 
<!-- 61.2  -->
`r spark_numbers %>% mutate(perc = n_app/sum(n_app)) %>% filter(is_positive == 1) %>% pull(perc) %>% round(2) *100`% of which contain at least one of the positive words. Compared to the other two funding schemes, the applicants to Spark are employed at the Universities of Applied Sciences at a higher percentage `r  (tab_inst %>% filter(variable == "UAS and Other") %>% pull(n_perc_spark) %>% str_extract_all("\\([^()]*\\)|[^()]+"))[[1]][2]`.
We note that the available funding was very different between the two Spark calls, so when we analyse successful proposals, we will consider "fundability" for Spark, rather than true funding success, in order to be able to use the same success criterion for both calls. The applicants were on averag `r tab_age %>% select(n_perc_spark) %>% substr( 1, 4)` years old.


```{r data and summary figures, cache = FALSE, echo = FALSE, results = 'hide'}
# Spark 
#-------
fig_spark_numbers <- 
  sparkabs_freq_ls %>%
  ggplot(aes(x = ResponsibleApplicantGender, 
             fill = ResponsibleApplicantGender)) + 
  geom_bar(position = position_stack(reverse = TRUE)) +
  scale_fill_manual(
    values = get_datastory_scheme(),
    name = "",
    labels = c("Female", "Male")
  ) +
  ylim(0, 450) +
  geom_text(size = 2.4, stat ='count', aes(label = ..count..), vjust = -0.5) +
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), 
        axis.title.y = element_blank()) +
  ggtitle(paste0("Spark: ", format(length(sparkabs_freq_ls$Number),
                                   big.mark = ",")," proposals")) 

# Number of fundable proposals
fig_spark_n_fundable <- gender_spark_ls_fundable %>%
  filter(IsFundable == 1) %>% 
  ggplot(aes(y = n, x = ResponsibleApplicantGender,
             fill = ResponsibleApplicantGender)) +   
  geom_bar(stat = 'identity') +
  scale_fill_manual(
    values =  get_datastory_scheme(),
    name = "",
    labels = c("Female", "Male")) +
  geom_text(size = 2.4, aes(label = n, x = ResponsibleApplicantGender),
            vjust = -0.5) +
  ylim(0, 180) + 
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
  ggtitle(paste0("Spark: ",
                 format(nrow(sparkabs_freq_ls_fundable), big.mark = ","),
                 " fundable proposals"))


# Project funding
#-----------------
fig_pf_numbers <- pf_freq_ls %>% 
  ggplot(aes(x = ResponsibleApplicantGender,
             fill = ResponsibleApplicantGender)) +
  geom_bar(position = position_stack(reverse = TRUE)) +
  scale_fill_manual(
    values =  get_datastory_scheme(),
    name = "",
    labels = c("Female", "Male")) +
  ylim(0, 6500) +
  geom_text(size=2.4, 
    stat='count', aes(label=..count..), vjust=-0.5) +
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
  ggtitle(paste0("Projects: ", format(length(pf_freq_ls$Number),
                                      big.mark = ","), " proposals"))

# Number of funded proposals
fig_pf_n_approved <- gender_pf %>% 
  filter(IsApproved == 1) %>% 
  ggplot(aes(y = n, x = ResponsibleApplicantGender,
             fill = ResponsibleApplicantGender))+   
  geom_bar(stat = 'identity') +
  scale_fill_manual(
    values = get_datastory_scheme(),
    name = "",
    labels = c("Female", "Male")) +
  geom_text(
    aes(label = n, x = ResponsibleApplicantGender),
    vjust = -0.5, size =2.4) +
  ylim(0, 2700) + 
  get_datastory_theme() + 
  theme(axis.title.x=element_blank(), axis.title.y=element_blank()) +
  ggtitle(paste0("Projects: ",
                 format(nrow(pf_freq_ls_approved), big.mark = ","),
                 " approved proposals"))

# Career
#--------
fig_career_numbers <-
  career_freq_ls %>% 
  ggplot(aes(x = ResponsibleApplicantGender,
             fill = ResponsibleApplicantGender)) +
  geom_bar(position = position_stack(reverse = TRUE)) +
  scale_fill_manual(
    values = get_datastory_scheme(),
    name = "",
    labels = c("female", "male")) +
  ylim(0, 1800) +
  geom_text(stat='count', aes(label = ..count..), vjust = -0.5, size = 2.4) +
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
  ggtitle(paste0("Careers: ", format(length(career_freq_ls$Number),
                                     big.mark = ",")," proposals"))

# Number of funded proposals
fig_career_n_approved <- gender_career %>% 
  filter(IsApproved == 1) %>%
  ggplot(aes(y = n, x = ResponsibleApplicantGender,
             fill = ResponsibleApplicantGender))+   
  geom_bar(stat = 'identity') +
  scale_fill_manual(
    values = get_datastory_scheme(),
    name = "",
    labels = c("female", "male")) +
  geom_text(aes(label = n, x = ResponsibleApplicantGender),
            vjust = -0.5, size =2.4) +
  ylim(0, 230) + 
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank()) +
  ggtitle(paste0("Careers: ",
                 format(nrow(career_freq_ls_approved), big.mark = ","),
                 " approved proposals"))

```

```{r summary-numbers, fig.width = 6,fig.height = 8, fig.cap = "The number of proposals in each funding scheme are shown in the first column by gender. The second column shows the number of funded (or fundable for Spark) proposals submitted by female and male applicants by funding scheme.", message = FALSE, warning = FALSE}

fig_numbers <- cowplot::plot_grid(
  (fig_pf_numbers + theme(legend.position = "none", 
                          axis.text.x = element_blank())),
  (fig_pf_n_approved + theme(legend.position = "none", 
                             axis.text.x = element_blank())),
  (fig_career_numbers + theme(legend.position = "none", 
                              axis.text.x = element_blank())),
  (fig_career_n_approved + theme(legend.position = "none", 
                                 axis.text.x = element_blank())),
  (fig_spark_numbers + theme(legend.position = "none", 
                             axis.text.x = element_blank())),
  (fig_spark_n_fundable + theme(legend.position = "none", 
                                axis.text.x = element_blank())), nrow =3
)


title_numbers <- ggdraw() #+
  # draw_label("Number of proposals and fundable or funded proposals in the Life Sciences",
  #            fontface = "bold")

grobs_numbers <- ggplotGrob(fig_spark_numbers)$grobs
legend_numbers <-
  grobs_numbers[[which(sapply(grobs_numbers, function(x)
    x$name) == "guide-box")]]


plot_grid(title_numbers,
          fig_numbers,
          legend_numbers,
          ncol = 1,
          rel_heights = c(0.1, 1, 0.05))
```

\pagebreak

```{r tab1, message = FALSE, warning = FALSE, cache = F, results = "asis"}
tab1 <- tab_fi %>% 
  mutate(group = "Total") %>% 
  bind_rows(tab_gender %>% 
              mutate(group = "Gender"),
            tab_inst %>% 
              mutate(group = "Institution Type"), 
            tab_age %>% 
              mutate(group = "Age at submission"),
            tab_textlength %>% 
              mutate(group = "Text length"), 
            tab_sum_pos %>% 
              mutate(group = "Number positive words"),
            tab_year %>% 
              mutate(group = "Call Year")) %>% 
  rename(" " = variable, 
         "Projects" = n_perc, 
         "Careers" = n_perc_car,
         "Spark" = n_perc_spark) %>% 
  as_grouped_data(groups = c("group")) %>% 
  as_flextable(hide_grouplabel = TRUE) %>% 
  set_caption(caption = "Descriptive Statistics for the tree funding schemes (Projects, Careers and Spark): count and percentage for factor variables, mean, maximum and minimum for continuous variables.") %>% 
  hline(i = c(2, 5, 9, 11, 13, 15)) %>% 
  bold(i = c(1, 3, 6, 10, 12, 14, 16)) %>% 
  bold(part = "header") %>% 
  width(width = 1.8) %>% 
  fontsize(size = 9, part = "body")

tab1 
```

## Positive Words

The positive words included in this study, as defined by @Vinkers2015 based on publications from PubMed, are: amazing, assuring, astonishing, bright, creative, encouraging, enormous, excellent, favorable/ favourable, groundbreaking, hopeful, innovative, inspiring, inventive, novel, phenomenal, prominent, promising, reassuring, remarkable, robust, spectacular, supportive, unique, and unprecedented.

<!-- In order to establish whether the list is also valid for other research areas, w -->
The percentage of grant proposal abstracts from the funding scheme Projects that include any of these words in each year is presented in Figure \@ref(fig:perc-one-poswords).  We observe that the use of positive terms has been increasing over time, a result consistent with the findings in @Vinkers2015.

<!-- We see that approximately the same percentage of proposals use these terms in both MINT and LS, and that their usage is increasing at a similar rate, and so we conclude that the words are used comparably in these two research areas. In SSH, however, the percentage of proposals that include any of these terms is about one third lower than in LS and MINT, and their use does not seem to be increasing as fast, if at all. It is clear that these words are used less frequently in SSH. However, since the words are still used consistently, we will include SSH proposals in our study, recognizing that the results in this research area may be less conclusive than in LS and MINT. -->

```{r perc-one-poswords, fig.height = 5, fig.align = "center", fig.width = 5, fig.cap = "The percentage of proposals from Projects that include any of the defined positive words.", message = FALSE, warning = FALSE}
pf_freq_ls %>% 
  group_by(CallYear) %>% 
  count(test = sum_pos > 0) %>% 
  mutate(freq = n/sum(n)) %>% 
  filter(test) %>% 
  ggplot(aes(x = as.factor(CallYear), y = freq)) +
  geom_col(position = position_dodge(), fill = get_datastory_scheme()[3], 
           color = "white") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), 
                     limits=c(0, .7)) +
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), 
        axis.title.y = element_blank()) +
  ggtitle(paste0("Proposals with positive words per year")) 
```

The distributions of the positive words across all three funding schemes are provided in Figure \@ref(fig:fig-specific-words) (included in the Appendix). Figure \@ref(fig:fig-distribution-number-poswords) shows the distribution of the number of positive words per funding scheme and gender of the corresponding applicant.


```{r fig-distribution-number-poswords, fig.align="center", fig.height = 8, fig.width = 6, fig.cap = "The distribution of the number of positive words used in the abstracts of the different funding schemes by gender of the corresponding applicant. All counts larger than 7 are regrouped into 7+.", message = FALSE, warning = FALSE}

p_pf <- pf_freq_ls %>% 
  group_by(ResponsibleApplicantGender) %>% 
  count(sum_pos) %>% 
  mutate(sum_pos = case_when(sum_pos >= 7 ~ "7+",
                             TRUE ~ as.character(sum_pos)),
         sum_pos = factor(sum_pos, levels = c(0:6, "7+"))) %>% 
  group_by(ResponsibleApplicantGender, sum_pos) %>% 
  summarise(n = sum(n)) %>%
  mutate(freq = n/sum(n)) %>% 
  ggplot(aes(x = sum_pos, y = freq, color = ResponsibleApplicantGender,
             fill = ResponsibleApplicantGender)) +
  geom_col(position = position_dodge(), color = "white") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), 
                     limits=c(0, .5)) +
  scale_fill_manual(
    values = get_datastory_scheme(),
    name = "",
    labels = c("Female", "Male")) +
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), 
        axis.title.y = element_blank()) +
  ggtitle(paste0("Projects")) 

p_careers <- career_freq_ls %>% 
  group_by(ResponsibleApplicantGender) %>% 
  count(sum_pos) %>% 
  mutate(sum_pos = case_when(sum_pos >= 7 ~ "7+",
                             TRUE ~ as.character(sum_pos)),
         sum_pos = factor(sum_pos, levels = c(0:6, "7+")))  %>% 
  group_by(ResponsibleApplicantGender, sum_pos) %>% 
  summarise(n = sum(n)) %>% 
  mutate(freq = n/sum(n)) %>% 
  ggplot(aes(x = sum_pos, y = freq, color = ResponsibleApplicantGender,
             fill = ResponsibleApplicantGender)) +
  geom_col(position = position_dodge(), color = "white") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), 
                     limits=c(0, .5)) +
  scale_fill_manual(
    values = get_datastory_scheme(),
    name = "",
    labels = c("Female", "Male")) +
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), 
        axis.title.y = element_blank()) +
  ggtitle(paste0("Careers")) 

p_spark <- sparkabs_freq_ls %>% 
  group_by(ResponsibleApplicantGender) %>% 
  count(sum_pos) %>% 
  mutate(sum_pos = case_when(sum_pos >= 7 ~ "7+",
                             TRUE ~ as.character(sum_pos)),
         sum_pos = factor(sum_pos, levels = c(0:6, "7+"))) %>% 
  group_by(ResponsibleApplicantGender, sum_pos) %>% 
  summarise(n = sum(n)) %>% 
  mutate(freq = n/sum(n)) %>% 
  ggplot(aes(x = sum_pos, y = freq, color = ResponsibleApplicantGender,
             fill = ResponsibleApplicantGender)) +
  geom_col(position = position_dodge(), color = "white") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), 
                     limits=c(0, .5)) +
  scale_fill_manual(
    values = get_datastory_scheme(),
    name = "",
    labels = c("Female", "Male")) +
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), 
        axis.title.y = element_blank()) +
  ggtitle(paste0("Spark")) 

p <- cowplot::plot_grid(p_pf + theme(legend.position = "none"), 
                        p_careers + theme(legend.position = "none"),
                        p_spark + theme(legend.position = "none"),
                        ncol = 1)
                        
title <- ggdraw() +
  draw_label("Distribution of the number of positve words by gender",
             fontface = "bold")

grobs <- ggplotGrob(p_pf)$grobs
legend <-
  grobs[[which(sapply(grobs, function(x)
    x$name) == "guide-box")]]

plot_grid(title,
          p,
          legend,
          ncol = 1,
          rel_heights = c(0.1, 1, 0.05))
```

## Statistical Methods

To determine whether the use of positive language correlates with the gender of the grant applicant @Lerchenmueller used multivariate linear probability regressions to model the binary outcome of whether a positive word was used at least once. In an attempt to replicate their results, we followed the same procedure. In addition, we perform a logistic regression to model the same binary outcome, as we view this type of model to be more suited to answer our research question. We then 
<!-- , we use logistic regression to model the binary outcome of whether a positive word was used at least once. This differs from @Lerchenmueller, where multivariate linear probability models were used. We further  -->
perform a Poisson regression to model the count of positive words in addition to simply their presence, to see if one gender might use a higher number of positive words. For all models, 
the age of the applicant, the type of institution, and the length of the text are taken as covariates, with gender as the variable of interest. 
The models are adjusted for age because we consider the applicant’s age to be a confounder. Age is a reasonable proxy for career stage, and it is understandable that researchers at different stages of their careers would construct texts differently. We additionally adjust for the institution type as a proxy for prestige. Depending on the reputation of the institutions, as well as the investment the institutions make in their individual grant writing services, the affiliated researchers may write more positively about their research (for example, see Figure \@ref(fig:fig-distribution-number-poswords-inst) in the Appendix). Additionally, the gender distributions at the different institution types varies considerably. The models are also adjusted for the length of the texts, as longer text have higher likelihood of containing more positive words.

<!-- In all cases, we stratify the proposal texts by research area within each funding scheme, as writing and grading cultures differ across research areas, and we would like to observe and quantify these differences. -->
<!-- We use the three research areas as defined at the SNSF: life sciences (LS), mathematics, informatics, natural sciences and technology (MINT), and social sciences and humanities (SSH).  -->
Note that we will determine the presence or absence of evidence of an effect based on 95% confidence intervals, which address the size of an effect more directly than p-values (@Wasserstein2016).

We first perform the analysis on all proposals to Projects, Careers and Spark. In a second step, we repeat the analysis but apply the models only to successful proposals.  The dataset of this second analysis is more similar to the original study of @Lerchenmueller which analyzed only published articles.  We note that the success of a grant proposal depends on many factors in addition to writing style, and so the current study does not allow us to make any conclusions about the influence of the writing on the success of a proposal. We leave such an extended analysis, including many other confounding variables, to future work.


<!-- \pagebreak -->

# Results

We present the results of our models relating the gender of the applicant to the use of positive language.

## Analysis of all proposals

Table \@ref(tab:tab-gender-linear-stratify) shows the results of the multivariate linear probability model adjusted for age (in years), the institution type and the length of the texts. Evidence for a gender effect on the presence of a positive word cannot be found in any of the models for the different funding scheme. Unsurprisingly, the length of the text increases the chance of a positive word significantly (e.g. positive coefficient with 95%CI not including zero). Additionally, we find evidence for an effect of the institution type in proposals to Projects: compared to researchers from cantonal universities, researchers affiliated to the ETH Domain have a higher probability of using at least one positive word when describing their research projects. 

\pagebreak

```{r tab-gender-linear-stratify, message = FALSE, warning = FALSE, cache = F, results = "asis"}
# list of covariates to be reported
covariate_list <- names(coefficients(sparkabs_reg_ls$linear))[-1]
# regression results 
reg_gender_linear_ls <- list(pf = pf_reg_ls$linear, 
                             career = career_reg_ls$linear ,
                             spark = sparkabs_reg_ls$linear)

ls_column_linear <- lapply(reg_gender_linear_ls,
                           FUN = tabulate_lm_ci,  
                           covariate_list = covariate_list,
                           is_word = is_word) %>% simplify()

var_column <- rep(c("gender - male", "age (years)",
                    "inst. type - ETH Domain", 
                    "inst. type - UAS and Other",
                    "text length (per 100 words)"), 3)

FI_column <- c(
  rep(paste0("Projects: ", format(nrow(pf_reg_ls$linear$model), big.mark = "'"),
             " observations"), 5),
  rep(paste0("Careers: ", format(nrow(career_reg_ls$linear$model),
                                 big.mark = "'"), " observations"), 5), 
  rep(paste0("Spark: ", format(nrow(sparkabs_reg_ls$linear$model),
                               big.mark = "'"), " observations"), 5))

tab_linear <- data.frame(FI_column,
                         var_column, ls_column_linear,
                         stringsAsFactors = FALSE)
row.names(tab_linear) <- NULL

tab_linear_print <- tab_linear %>% 
  as_grouped_data(groups = "FI_column") %>%
  as_flextable(hide_grouplabel = TRUE,
               col_keys = c("var_column",
                            "ls_column_linear"))%>%
  colformat_md(j = c(3)) %>%
  set_header_labels(var_column = " ",
                    ls_column_linear = "Coefficient Estimate (95% CI)") %>%
  bold(bold = TRUE, part = c("header")) %>%
  set_caption(caption = "Multivariate linear probability model of applicants using a positive term at least once in their texts. The reference for the gender variable is female and for the institution (inst.) type factor variable is 'Cantonal University'. The bold coefficient estimates are significantly different from zero.")%>%
  width(width = 3) %>% 
  hline(i = c(6, 12)) %>% 
  bold(i = c(1, 7, 13))

tab_linear_print 
```

In a second model, Table \@ref(tab:tab-gender-binary-stratify) shows the odds ratios from the logistic regression, modelling the binary outcome “at least one positive word”, for all three data sources. A gender OR (male vs. female) larger than 1 suggests that male researchers are more likely to use at least one positive word compared to female researchers (used as the reference). We again do not see any evidence for gender differences in language usage in any of the funding schemes. The results are indeed very similar to the linear probability model which is reassuring.
<!-- Gender differences appear in both Projects and Spark, but only in SSH. In Projects, the SSH odds ratio is 1.234, meaning that male applicants were 1.234 times likelier to use a positive word than their female peers, while in Spark, the odds ratio of 0.675 means that male applicants were only 0.675 times as likely as their female peers to use a positive word. Interestingly, in Projects, male SSH applicants are more likely to use at least one positive word, while in Spark it was the female applicants who were more likely to use at least one positive word. -->


```{r ci pf binary}
## ----pf binary stratify----
pf_binary_ci_ls <- calculate_ci(
  summary(pf_reg_ls$log)$coefficients["ResponsibleApplicantGenderm", ])

```

```{r tab-gender-binary-stratify, message = FALSE, warning = FALSE, cache = F, results = "asis"}
# list of covariates to be reported
covariate_list <- names(coefficients(sparkabs_reg_ls$log))[-1]
# regression results 
reg_gender_binary_ls <- list(pf = pf_reg_ls$log, 
                             career = career_reg_ls$log ,
                             spark = sparkabs_reg_ls$log)

ls_column <- lapply(reg_gender_binary_ls,
                    FUN = tabulate_ci,  
                    covariate_list = covariate_list,
                    is_word = is_word) %>% simplify()

var_column <- rep(c("gender - male", "age (years)",
                    "inst. type - ETH Domain", 
                    "inst. type - UAS and Other",
                    "text length (per 100 words)"), 3)

FI_column <- c(
  rep(paste0("Projects: ", format(nrow(pf_reg_ls$log$model), big.mark = "'"),
             " observations"), 5),
  rep(paste0("Careers: ", format(nrow(career_reg_ls$log$model), big.mark = "'"),
             " observations"), 5), 
  rep(paste0("Spark: ", format(nrow(sparkabs_reg_ls$log$model), big.mark = "'"),
             " observations"), 5))

tab_binary <- data.frame(FI_column,
                         var_column, ls_column,
                         stringsAsFactors = FALSE)
row.names(tab_binary) <- NULL

tab_binary_print <- tab_binary %>% 
  as_grouped_data(groups = "FI_column") %>%
  as_flextable(hide_grouplabel = TRUE,
               col_keys = c("var_column",
                            "ls_column"))%>%
  colformat_md(j = c(3)) %>%
  set_header_labels(var_column = " ",
                    ls_column = "OR Estimate (95% CI)") %>%
  bold(bold = TRUE, part = c("header")) %>%
  set_caption(caption = "Odds ratios (OR) of applicants using a positive term at least once in their texts. The reference for the gender variable is female and for the institution (inst.) type factor variable is 'Cantonal University'. The bold coefficient estimates are significantly different from one.") %>%
  width(width = 3) %>% 
  hline(i = c(6, 12)) %>% 
  bold(i = c(1, 7, 13))

tab_binary_print 
```



```{r ci pf count ssh}

pf_count_ci_ls <- calculate_ci(
  summary(
    pf_reg_ls$count)$coefficients["ResponsibleApplicantGenderm", ])
```

In the Poisson regression summarized in Table \@ref(tab:tab-gender-count-ls), the outcome “positive words” is treated as a count variable rather than the binary presence/absence. Here we provide the rate ratios of the use of positive words (the exponential of the regression coefficient). These incident rate ratios, also called relative risks, essentially tell us how many more (or fewer) positive words are expected, compared to a reference for factor and binary variables, or for a unit change of the continuous explanatory variable. 
We again do not observe significant gender differences for applicants in any of the funding schemes. In Projects and Spark, younger researchers tend to use more positive words than their older peers. As expected, more positive words can be found in longer texts. In Projects, researchers from the ETH Domain have a higher positive word count compared to cantonal universities, while in Careers, researchers affiliated in UAS and others tend to describe their research less positively than their peers from the cantonal universities.
<!-- We can draw the same conclusions as in Table 1 for SSH applicants in Projects (22% more positive words for male applicants compared to their female peers) and Spark (21.6% fewer positive words in texts written by male researchers compared to their female peers). However now there is also evidence for an effect in MINT, where males in both Projects and Careers use on average 11% more positive words than their female counterparts. -->


```{r tab-gender-count-ls, message = FALSE, warning = FALSE, cache = F, results = "asis"}
# regression results for reach research area
reg_gender_count_ls <- list(pf = pf_reg_ls$count, 
                            career = career_reg_ls$count,
                            spark = sparkabs_reg_ls$count)

ls_column_count <- lapply(reg_gender_count_ls,
                          FUN = tabulate_ci,  
                          covariate_list = covariate_list,
                          is_word = is_word) %>% simplify()

var_column <- rep(c("gender - male", "age (years)",
                    "inst. type - ETH Domain", 
                    "inst. type - UAS and Other",
                    "text length (per 100 words)"), 3)

FI_column <- c(
  rep(paste0("Projects: ", format(nrow(pf_reg_ls$count$model), big.mark = "'"),
             " observations"), 5),
  rep(paste0("Careers: ", format(nrow(career_reg_ls$count$model),
                                 big.mark = "'"), " observations"), 5), 
  rep(paste0("Spark: ", format(nrow(sparkabs_reg_ls$count$model),
                               big.mark = "'"), " observations"), 5))

tab_count <- data.frame(FI_column, var_column, ls_column_count,
                        stringsAsFactors = FALSE)
row.names(tab_count) <- NULL

tab_count_print <- tab_count %>% 
  as_grouped_data(groups = "FI_column") %>%
  as_flextable(hide_grouplabel = TRUE,
               col_keys = c("var_column",
                            "ls_column_count"))%>%
  colformat_md(j = c(3)) %>%
  set_header_labels(var_column = " ",
                    ls_column_count = "RR Estimate (95% CI)") %>%
  bold(bold = TRUE, part = c("header")) %>%
  set_caption(caption = "Rate ratios (RR) counting the number of positive terms in grant proposals. The reference for the gender variable is female and for the institution (inst.) type factor variable is 'Cantonal University'. The bold estimates are significantly different from one.")%>%
  width(width = 3) %>% 
  hline(i = c(6, 12)) %>% 
  bold(i = c(1, 7, 13))

tab_count_print 
```


```{r prep-fig-interaction-gender, cache = FALSE, results = "asis", warning = FALSE, message = FALSE}
# Spark abstracts
spark_models <- list(ls = sparkabs_reg_ls$count)
spark_pred <- lapply(spark_models, get_predict_words, 
                     freq_data = sparkabs_freq_ls) %>% bind_rows(.id = "area")

pf_models <- list(ls = pf_reg_ls$count)
pf_pred <- lapply(pf_models, get_predict_words,
                  freq_data = pf_freq_ls) %>% bind_rows(.id = "area")

career_models <- list(ls = career_reg_ls$count)
career_pred <- lapply(career_models, get_predict_words, 
                      freq_data = career_freq_ls) %>% bind_rows(.id = "area")

fig_spark_abs <- spark_pred %>% 
  filter(area == "ls") %>% 
  mutate(ResponsibleApplicantGender = 
           case_when(ResponsibleApplicantGender == "f" ~ "Female",
                     ResponsibleApplicantGender == "m" ~ "Male")) %>% 
  ggplot(aes(ResponsibleApplicantGender, pred))+
  geom_pointrange(aes(ymin = lwr, ymax = upr),
                  position = position_dodge(width = 0.5)) +
  get_datastory_theme() +
  ylab("Predicted number of words") +
  theme(axis.title.x = element_blank()) +
  ggtitle("Spark") +
  ylim(.8, 2)
  
fig_pf <- pf_pred %>% 
  filter(area == "ls") %>% 
  mutate(ResponsibleApplicantGender = 
           case_when(ResponsibleApplicantGender == "f" ~ "Female",
                     ResponsibleApplicantGender == "m" ~ "Male")) %>% 
  ggplot(aes(ResponsibleApplicantGender, pred)) +
  geom_pointrange(aes(ymin = lwr, ymax = upr),
                  position = position_dodge(width = 0.5)) +
  get_datastory_theme() +
  ylab("Predicted number of words") +
  theme(axis.title.x = element_blank()) +
  ggtitle("Projects") + 
  ylim(.8, 2)


fig_career <- career_pred %>% 
  filter(area == "ls") %>% 
  mutate(ResponsibleApplicantGender = 
           case_when(ResponsibleApplicantGender == "f" ~ "Female",
                     ResponsibleApplicantGender == "m" ~ "Male")) %>% 
  ggplot(aes(ResponsibleApplicantGender, pred))+
  geom_pointrange(aes(ymin = lwr, ymax = upr),
                  position = position_dodge(width = 0.5)) +
  get_datastory_theme() +
  ylab("Predicted number of words") +
  theme(axis.title.x = element_blank()) +
  ggtitle("Careers") +
  ylim(.8, 2)
```

Figure \@ref(fig:fig-interaction-gender) illustrates the effects of gender on the language used in the Poisson regression models. The plots show the predicted number of positive words with 95% confidence error bars per gender, for an applicant of average age with a proposal of average text length from a cantonal university, for each funding scheme. 
<!-- We observe the interesting difference between the Spark and Projects in the SSH domain in green, as discussed above. In Projects, male applicants used more positive words, while in Spark, female applicants used more positive words. In Careers, there was no significant difference as their confidence intervals overlap. -->

We conclude that we cannot detect a difference in the use of positive words between male and female applicants in Life Sciences in any of the funding schemes. This is noteworthy, because the words used in our analysis were derived from PubMed abstracts (@Vinkers2015) and the original study (@Lerchenmueller) found a significant gender differences in their usage from clinical research and general life science articles indexed in PubMed. But that study only compared successful publications, while 
this analysis <!-- our study -->
includes both funded and rejected proposals.

<!-- Projects, the funding scheme with the largest sample size, shows gender differences in MINT and SSH. We observe evidence that male applicants in MINT and SSH use more positive words than their female counterparts. There is also weak evidence that male MINT applicants in Careers use more positive words than their female peers. -->

<!-- The trend is different for SSH applicants in Spark. In Spark, female applicants are more likely to use higher count of positive words in their texts than male applicants, unlike in Projects. -->


```{r fig-interaction-gender, fig.width = 6,fig.height = 3.5, fig.cap = "Illustration of the effects of gender on the language used in the Poisson regression models. The plots show the predicted number of positive words with 95% confidence error bars per gender, for an applicant of average age with a proposal of average text length, for each funding scheme. In all three funding schemes, male applicants used more positive words, but there was no significant difference as their confidence intervals overlap.", cache = FALSE, results = "asis", warning = FALSE, message = FALSE}

# Original caption: Illustration of the effects of gender and research area on the count of positive words for each funding instrument based on the fitted models. The plots are based on predicted number of positive used by applicants of each gender with average age and average abstract length of each instrument. In Spark, there is a small evidence that SSH female applicants used higher count of positive terms than their male peers, in constract to Projects, where male applicants are likelier to use higher count of positive words.

ggarrange(fig_pf, fig_career, fig_spark_abs,
          nrow = 1)
```

## Analysis of successful proposals only
To perform an analysis more similar to the original version presented in @Lerchenmueller, we will now repeat our analysis on only the subset of proposals that were funded (or in the case of Spark, fundable). Table \@ref(tab:tab-gender-linear-stratify-approved) summarises the linear probability model on the successful proposals only. Compared to the model applied on all proposals, the conclusions stay the same for Careers and Spark, even though the magnitude of the coefficient estimates does change. In Projects, the evidence for an effect of the institution type weakens, while the evidence for an age-effect strengthens. The same conclusions and changes can be observed for the logistic regression model summarised for the successful proposals in Table \@ref(tab:tab-gender-binary-stratify-approved). 

```{r get-approved-models}
#--------------------------------------
## ADAPTED FROM chunk_gender_on_language.R analysis: gender on language
#--------------------------------------
# Analysis of the whether gender has an effect on the use of words as through..
# .. binary variable for the presence of at least one positive word
# .. .. using linear probability models
# .. .. using logistic regression models
# .. the count of distinct positive words using Poisson regression
# .. .. quasipoisson and negative binomial regression


# spark abstracts
# ---------------
sparkabs_reg_ls_fundable <- sparkabs_freq_ls_fundable %>%
  analyze_gender()

# pf abstracts
# ---------------
pf_reg_ls_approved <- pf_freq_ls_approved %>%
  analyze_gender()

# career abstracts
# ---------------
career_reg_ls_approved <- career_freq_ls_approved %>%
  analyze_gender()

```

```{r tab-gender-linear-stratify-approved, message = FALSE, warning = FALSE, cache = F, results = "asis"}
# list of covariates to be reported
covariate_list <- names(coefficients(sparkabs_reg_ls_fundable$linear))[-1]
# regression results 
reg_gender_linear_ls <- list(pf = pf_reg_ls_approved$linear, 
                             career = career_reg_ls_approved$linear ,
                             spark = sparkabs_reg_ls_fundable$linear)

ls_column_linear <- lapply(reg_gender_linear_ls,
                           FUN = tabulate_lm_ci,  
                           covariate_list = covariate_list,
                           is_word = is_word) %>% simplify()

var_column <- rep(c("gender - male", "age (years)",
                    "inst. type - ETH Domain", 
                    "inst. type - UAS and Other",
                    "text length (per 100 words)"), 3)

FI_column <- c(
  rep(paste0("Projects: ", format(nrow(pf_reg_ls_approved$linear$model),
                                  big.mark = "'"), " observations"), 5),
  rep(paste0("Careers: ", format(nrow(career_reg_ls_approved$linear$model),
                                 big.mark = "'"), " observations"), 5), 
  rep(paste0("Spark: ", format(nrow(sparkabs_reg_ls_fundable$linear$model),
                               big.mark = "'"), " observations"), 5))

tab_linear <- data.frame(FI_column,
                         var_column, ls_column_linear,
                         stringsAsFactors = FALSE)
row.names(tab_linear) <- NULL

tab_linear_print <- tab_linear %>% 
  as_grouped_data(groups = "FI_column") %>%
  as_flextable(hide_grouplabel = TRUE,
               col_keys = c("var_column",
                            "ls_column_linear"))%>%
  colformat_md(j = c(3)) %>%
  set_header_labels(var_column = " ",
                    ls_column_linear = "Coefficient Estimate (95% CI)") %>%
  bold(bold = TRUE, part = c("header")) %>%
  set_caption(caption = "Multivariate linear probability model of applicants of successful proposals using a positive term at least once in their texts. The reference for the gender variable is female and for the institution (inst.) type factor variable is 'Cantonal University'. The bold coefficient estimates are significantly different from zero.")%>%
  width(width = 3) %>% 
  hline(i = c(6, 12)) %>% 
  bold(i = c(1, 7, 13))

tab_linear_print 
```

\pagebreak 

```{r tab-gender-binary-stratify-approved, message = FALSE, warning = FALSE, cache = F, results = "asis"}
# list of covariates to be reported
covariate_list <- names(coefficients(sparkabs_reg_ls_fundable$log))[-1]
# regression results 
reg_gender_binary_ls_approved <- list(pf = pf_reg_ls_approved$log, 
                                      career = career_reg_ls_approved$log,
                                      spark = sparkabs_reg_ls_fundable$log)

ls_column_approved <- lapply(reg_gender_binary_ls_approved,
                             FUN = tabulate_ci,  
                             covariate_list = covariate_list,
                             is_word = is_word) %>% simplify()

var_column <- rep(c("gender - male", "age (years)",
                    "inst. type - ETH Domain", 
                    "inst. type - UAS and Other",
                    "text length (per 100 words)"), 3)

FI_column <- c(
  rep(paste0("Projects: ", format(nrow(pf_reg_ls_approved$log$model),
                                  big.mark = "'"), " observations"), 5),
  rep(paste0("Careers: ", format(nrow(career_reg_ls_approved$log$model),
                                 big.mark = "'"), " observations"), 5), 
  rep(paste0("Spark: ", format(nrow(sparkabs_reg_ls_fundable$log$model),
                               big.mark = "'"), " observations"), 5))

tab_binary_approved <- data.frame(FI_column,
                                  var_column, ls_column_approved,
                                  stringsAsFactors = FALSE)
row.names(tab_binary_approved) <- NULL

tab_binary_approved_print <- tab_binary_approved %>% 
  as_grouped_data(groups = "FI_column") %>%
  as_flextable(hide_grouplabel = TRUE,
               col_keys = c("var_column",
                            "ls_column_approved"))%>%
  colformat_md(j = c(3)) %>%
  set_header_labels(var_column = " ",
                    ls_column_approved = "OR Estimate (95% CI)") %>%
  bold(bold = TRUE, part = c("header")) %>%
  set_caption(caption = "Odds ratios (OR) of applicants of successful proposals using a positive term at least once in their texts. The reference for the gender variable is female and for the institution (inst.) type factor variable is 'Cantonal University'. The bold coefficient estimates are significantly different from one.") %>% 
  width(width = 3) %>% 
  hline(i = c(6, 12)) %>% 
  bold(i = c(1, 7, 13))

tab_binary_approved_print 
```

Finally, Table \@ref(tab:tab-gender-count-ls-approved) shows the results of the Poisson model on the successful proposals. Again, in Careers and Spark we do not observe a substantial change in the conclusions. However, in Projects, we do now have evidence for a gender effect, with male researchers using more positive words in their proposal abstract than their female peers. 

Figure \@ref(fig:fig-interaction-gender-approved) shows the effects of gender on the language used in the Poisson regression models for the successful proposals only.  Compared to the situation when all proposals are considered, we see that successful female applicants in Careers and Spark actually tended to use more positive words than their male peers, while in Projects male applicants use more in each proposal, and the difference is stronger when only successful proposals are considered.

Since the Projects funding schemes funds all types of bottom-up research from all types of researchers, it is perhaps the most similar funding scheme to the data in the original @Lerchenmueller study. These results therefore seem to confirm the original finding, at least in the most similar of the three settings analyzed here, although we observe a weaker effect size.

```{r tab-gender-count-ls-approved, message = FALSE, warning = FALSE, cache = F, results = "asis"}
# regression results for reach research area
reg_gender_count_ls_approved <- list(pf = pf_reg_ls_approved$count, 
                                     career = career_reg_ls_approved$count,
                                     spark = sparkabs_reg_ls_fundable$count)

ls_column_count_approved <- lapply(reg_gender_count_ls_approved,
                                   FUN = tabulate_ci,  
                                   covariate_list = covariate_list,
                                   is_word = is_word) %>% simplify()

var_column <- rep(c("gender - male", "age (years)",
                    "inst. type - ETH Domain", 
                    "inst. type - UAS and Other",
                    "text length (per 100 words)"), 3)

FI_column <- c(
  rep(paste0("Projects: ", format(nrow(pf_reg_ls_approved$count$model),
                                  big.mark = "'"), " observations"), 5),
  rep(paste0("Careers: ", format(nrow(career_reg_ls_approved$count$model),
                                 big.mark = "'"), " observations"), 5), 
  rep(paste0("Spark: ", format(nrow(sparkabs_reg_ls_fundable$count$model),
                               big.mark = "'"), " observations"), 5))

tab_count_approved <- data.frame(FI_column, var_column, 
                                 ls_column_count_approved,
                                 stringsAsFactors = FALSE)
row.names(tab_count_approved) <- NULL

tab_count_print <- tab_count_approved %>% 
  as_grouped_data(groups = "FI_column") %>%
  as_flextable(hide_grouplabel = TRUE,
               col_keys = c("var_column",
                            "ls_column_count_approved"))%>%
  colformat_md(j = c(3)) %>%
  set_header_labels(var_column = " ",
                    ls_column_count_approved = "RR Estimate (95% CI)") %>%
  bold(bold = TRUE, part = c("header")) %>%
  set_caption(caption = "Rate ratios (RR) counting the number of positive terms in successful grant proposals.. The reference for the gender variable is female and for the institution (inst.) type factor variable is 'Cantonal University'. The bold estimates are significantly different from one.")%>%
  width(width = 3) %>% 
  hline(i = c(6, 12)) %>% 
  bold(i = c(1, 7, 13))

tab_count_print 
```

```{r prep-fig-interaction-gender-approved, cache = FALSE, results = "asis", warning = FALSE, message = FALSE}
# Spark abstracts
spark_models_fundable <- list(ls = sparkabs_reg_ls_fundable$count)
spark_pred_fundable <- lapply(spark_models_fundable, get_predict_words,
                              freq_data = sparkabs_freq_ls_fundable) %>% 
  bind_rows(.id = "area")

pf_models_approved <- list(ls = pf_reg_ls_approved$count)
pf_pred_approved <- lapply(pf_models_approved, get_predict_words,
                           freq_data = pf_freq_ls_approved) %>% 
  bind_rows(.id = "area")

career_models_approved <- list(ls = career_reg_ls_approved$count)
career_pred_approved <- lapply(career_models_approved, get_predict_words, 
                               freq_data = career_freq_ls_approved) %>%
  bind_rows(.id = "area")

fig_spark_abs_fundable <- spark_pred_fundable %>% 
  filter(area == "ls") %>% 
  mutate(ResponsibleApplicantGender = 
           case_when(ResponsibleApplicantGender == "f" ~ "Female",
                     ResponsibleApplicantGender == "m" ~ "Male")) %>% 
  ggplot(aes(ResponsibleApplicantGender, pred))+
  geom_pointrange(aes(ymin=lwr,ymax=upr),position = position_dodge(width = 0.5)) +
  get_datastory_theme() +
  ylab("Predicted number of words") +
  theme(axis.title.x = element_blank()) +
  ggtitle("Spark") +
  ylim(.8, 2)
  

fig_pf_approved <- pf_pred_approved %>% 
  filter(area == "ls") %>% 
  mutate(ResponsibleApplicantGender = 
           case_when(ResponsibleApplicantGender == "f" ~ "Female",
                     ResponsibleApplicantGender == "m" ~ "Male")) %>% 
  ggplot(aes(ResponsibleApplicantGender, pred)) +
  geom_pointrange(aes(ymin=lwr,ymax=upr),position = position_dodge(width = 0.5)) +
  get_datastory_theme() +
  ylab("Predicted number of words") +
  theme(axis.title.x = element_blank()) +
  ggtitle("Projects") + 
  ylim(.8, 2)


fig_career_approved <- career_pred_approved %>% 
  filter(area == "ls") %>% 
  mutate(ResponsibleApplicantGender = 
           case_when(ResponsibleApplicantGender == "f" ~ "Female",
                     ResponsibleApplicantGender == "m" ~ "Male")) %>% 
  ggplot(aes(ResponsibleApplicantGender, pred))+
  geom_pointrange(aes(ymin=lwr,ymax=upr),position = position_dodge(width = 0.5)) +
  get_datastory_theme() +
  ylab("Predicted number of words") +
  theme(axis.title.x = element_blank()) +
  ggtitle("Careers") +
  ylim(.8, 2)
```

```{r fig-interaction-gender-approved, fig.width = 6,fig.height = 3.5, fig.cap = "Illustration of the effects of gender on the language used in the Poisson regression models, for approved proposals. The plots show the predicted number of positive words with 95% confidence error bars per gender, for an applicant of average age with a proposal of average text length, for each funding scheme.", cache = FALSE, results = "asis", warning = FALSE, message = FALSE}

ggarrange(fig_pf_approved, fig_career_approved, fig_spark_abs_fundable,
          nrow = 1)
```

# Discussion

Our interest in this topic was motivated in part by the desire to understand if the grant evaluation process is influenced by language use.  If it is, this could be contributing to the “leaky pipeline” of women leaving academic careers. Our results indicate that the use of self-promotional language – at least to the limited extent analyzed in this study – does not appear to differ significantly between male and female grant applicants.

The SNSF first looked into the use of self-promotional language after the first Spark call, when it was found that, in spite of the double-blind evaluation process, female applicants had a significantly lower success rate than their male counterparts. One hypothesis was that perhaps the proposals themselves were written in different styles. However, our analysis here shows that there is no evidence for a significant difference in the use of positive words between the proposal texts of men and women. We performed a separate statistical analysis, beyond the scope of the current work, that looked at several confounding variables, and we found that adjusting for the confounding variables (discipline, type of research institution, applicant age) explained the observed differences in success rates between the genders. In the second Spark funding call, no evidence for a difference in success rates between men and women could be observed.  _Could remove this paragraph_

In Projects, our gender analysis is limited by the fact that we only consider the gender of the corresponding applicant, even though proposals are often submitted by multiple applicants. While it has historically been the case that corresponding applicants generally write most of the proposal, we recognize that many Projects proposals are written collaboratively. The SNSF stands firm in its belief that collaborative research is very important for scientific research.

The 25 "positive words" used in our analysis were derived from life sciences abstracts found in PubMed (@Vinkers2015). Similar to the original @Lerchenmueller study, we found that successful life sciences Projects proposals were more likely to contain these positive words, although we found no evidence for such an effect in the Careers or Spark funding schemes.  It is possible that the observed effect of positive words in Projects but not in the other two funding schemes may simply be due to its higher sample size, and consequently higher statistical power.  However, it is interesting to note that no affect for any gender difference was found when considering both successful and rejected proposals together, even though this is a much bigger data set.  The direction of the effect also changed in Careers and Spark between the full data set and only the successful data set, although the effect was not significantly significant.

This work is a replication study that analyses the difference in the use of positive language between male and female grant applicants.  The analysis presented here must not be interpreted as providing any evidence of the effect of positive language on grant funding decisions.  Many other confounding variables affect grant funding decisions, and we intentionally analyze all proposals in an entirely separate analysis from successful proposals.  A more complete analysis of all relevant variables that go into grant funding decisions is left for future work.

Overall, we see it as an encouraging result that we do not observe any large differences in the use of self-promotional language between the genders in their grant proposals.


# Acknowledgements

The authors would like to thank Fabio Molo for his significant contributions to the inception and development of this project.

# Contributors
SL performed the initial statistical analyses and wrote the first draft. RH provided statistical consulting and extended the analyses.  AJ revised and oversaw the project. All authors contributed to and approved the final version.

# Competing interests
All authors are employees of the Swiss National Science Foundation.

# Data availability statement
_RH: This will not pass. The aggregated binary and count data can easily be pseudo-anonymised and the script and this RMD could be uploaded on github. To be updated _
The data in this study include the titles and abstracts of rejected grant proposals, which are not possible to anonymize, and therefore considered to be confidential by the SNSF.

# References

<div id="refs"></div>

# (APPENDIX) Appendix {-}

```{r fig-specific-words, fig.height = 8, fig.width = 6, fig.cap = "Gender differences in positive language usage in the life sciences, per fundingi scheme.", message = FALSE, warning = FALSE}

# Removed from caption: In analysis of top ten most used words in each research area, no significant gender difference was found in LS. In MINT, male applicants used *robust*, *prominent*, and *remarkable* while female applicants used *innovative* significantly more. In SSH, male applicants used *unique*, *prominent* and *innovative* significantly more.

#Note: Edit the caption according to significant results for analyze_specificwords in the code chunk: r specific words
p <- cowplot::plot_grid(pf_plot + 
                          labs(title = "Projects") +
                          theme(legend.position = "none"), 
                        career_plot + 
                          labs(title = "Careers") +
                          theme(legend.position = "none"),
                        sparkabs_plot +
                          labs(title = "Spark") +
                          theme(legend.position = "none"),
                        ncol = 1)
                        
title <- ggdraw() +
  draw_label("Positive word distribution by gender", fontface = "bold")

grobs <- ggplotGrob(pf_plot)$grobs
legend <-
  grobs[[which(sapply(grobs, function(x)
    x$name) == "guide-box")]]

plot_grid(title,
          p,
          legend,
          ncol = 1,
          rel_heights = c(0.1, 1, 0.05))
```


```{r fig-distribution-number-poswords-inst, fig.height = 8, fig.width = 6, fig.cap = "Distribution of the number of positive words by Institution Type and funding scheme.", message = FALSE, warning = FALSE}

p_pf <- pf_freq_ls %>% 
  mutate(ResearchInstitutionType = 
           case_when(ResearchInstitutionType %in% 
                       c("Other", "Other research institutes", 
                         "Hospitals (non-university)",
                         "University of applied sciences") ~ "UAS and Other",
                     TRUE ~ ResearchInstitutionType)) %>% 
  group_by(ResearchInstitutionType) %>% 
  count(sum_pos) %>% 
  mutate(sum_pos = case_when(sum_pos >= 7 ~ "7+",
                             TRUE ~ as.character(sum_pos)),
         sum_pos = factor(sum_pos, levels = c(0:6, "7+"))) %>% 
  group_by(ResearchInstitutionType, sum_pos) %>% 
  summarise(n = sum(n)) %>% 
  mutate(perc = n/sum(n)) %>% 
  ggplot(aes(x = sum_pos, y = perc, color = ResearchInstitutionType,
             fill = ResearchInstitutionType)) +
  geom_col(position = position_dodge(), color = "white") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), 
                     limits=c(0, .55)) +
  scale_fill_manual(
    values = get_datastory_scheme(),
    name = "") +
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), 
        axis.title.y = element_blank()) +
  ggtitle(paste0("Projects")) 

p_careers <- career_freq_ls %>% 
  mutate(ResearchInstitutionType = 
           case_when(ResearchInstitutionType %in% 
                       c("Other", "Other research institutes", 
                         "Hospitals (non-university)",
                         "University of applied sciences") ~ "UAS and Other",
                     TRUE ~ ResearchInstitutionType))%>% 
  group_by(ResearchInstitutionType) %>% 
  count(sum_pos) %>% 
  mutate(sum_pos = case_when(sum_pos >= 7 ~ "7+",
                             TRUE ~ as.character(sum_pos)),
         sum_pos = factor(sum_pos, levels = c(0:6, "7+")))  %>% 
  group_by(ResearchInstitutionType, sum_pos) %>% 
  summarise(n = sum(n)) %>% 
  mutate(perc = n/sum(n)) %>% 
  ggplot(aes(x = sum_pos, y = perc, color = ResearchInstitutionType,
             fill = ResearchInstitutionType)) +
  geom_col(position = position_dodge(), color = "white") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), 
                     limits=c(0, .55)) +
  scale_fill_manual(
    values = get_datastory_scheme(),
    name = "") +
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), 
        axis.title.y = element_blank()) +
  ggtitle(paste0("Careers")) 

p_spark <- sparkabs_freq_ls %>% 
    mutate(ResearchInstitutionType = 
             case_when(ResearchInstitutionType %in% 
                         c("Other", "Other research institutes", 
                           "Hospitals (non-university)",
                           "University of applied sciences") ~ "UAS and Other",
                       TRUE ~ ResearchInstitutionType))%>% 
  group_by(ResearchInstitutionType) %>% 
  count(sum_pos) %>% 
  mutate(sum_pos = case_when(sum_pos >= 7 ~ "7+",
                             TRUE ~ as.character(sum_pos)),
         sum_pos = factor(sum_pos, levels = c(0:6, "7+"))) %>% 
  group_by(ResearchInstitutionType, sum_pos) %>% 
  summarise(n = sum(n)) %>% 
  mutate(perc = n/sum(n)) %>% 
  ggplot(aes(x = sum_pos, y = perc, color = ResearchInstitutionType,
             fill = ResearchInstitutionType)) +
  geom_col(position = position_dodge(), color = "white") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), 
                     limits=c(0, .55)) +
  scale_fill_manual(
    values = get_datastory_scheme(),
    name = "") +
  get_datastory_theme() + 
  theme(axis.title.x = element_blank(), 
        axis.title.y = element_blank()) +
  ggtitle(paste0("Spark")) 

p <- cowplot::plot_grid(p_pf + theme(legend.position = "none"), 
                        p_careers + theme(legend.position = "none"),
                        p_spark + theme(legend.position = "none"),
                        ncol = 1)
                        
title <- ggdraw() +
  draw_label("Positive word counts by institution type",
             fontface = "bold")

grobs <- ggplotGrob(p_pf)$grobs
legend <-
  grobs[[which(sapply(grobs, function(x)
    x$name) == "guide-box")]]

plot_grid(title,
          p,
          legend,
          ncol = 1,
          rel_heights = c(0.1, 1, 0.05))
```

